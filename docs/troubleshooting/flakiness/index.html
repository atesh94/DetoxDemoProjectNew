<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="Detox" href="/Detox/opensearch.xml"><title data-react-helmet="true">Dealing With Flakiness in Tests | Detox</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wix.github.io/Detox/docs/troubleshooting/flakiness"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Dealing With Flakiness in Tests | Detox"><meta data-react-helmet="true" name="description" content="Dealing With Flakiness in Tests"><meta data-react-helmet="true" property="og:description" content="Dealing With Flakiness in Tests"><link data-react-helmet="true" rel="shortcut icon" href="/Detox/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wix.github.io/Detox/docs/troubleshooting/flakiness"><link data-react-helmet="true" rel="alternate" href="https://wix.github.io/Detox/docs/troubleshooting/flakiness" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wix.github.io/Detox/docs/troubleshooting/flakiness" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Detox/assets/css/styles.c8787d8d.css">
<link rel="preload" href="/Detox/assets/js/runtime~main.fe902db8.js" as="script">
<link rel="preload" href="/Detox/assets/js/main.f7c8efd5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Detox/"><div class="navbar__logo"><img src="/Detox/img/logo.png" alt="Detox Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/Detox/img/logo.png" alt="Detox Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Detox</b></a><a class="navbar__item navbar__link navbar__link--active" href="/Detox/docs/introduction/getting-started">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wix/Detox" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Troubleshooting</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/troubleshooting/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/troubleshooting/building-the-app">Dealing With Problems With Building the App &amp; Detox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/troubleshooting/running-tests">Dealing With Problems With Running Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/troubleshooting/synchronization">Dealing With Synchronization Issues in Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Detox/docs/troubleshooting/flakiness">Dealing With Flakiness in Tests</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Guides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Detox/docs/contributing">Contributing</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Dealing With Flakiness in Tests</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="dealing-with-flakiness-in-tests">Dealing With Flakiness in Tests<a aria-hidden="true" class="hash-link" href="#dealing-with-flakiness-in-tests" title="Direct link to heading">â€‹</a></h2><blockquote><p>What is a flaky test?</p></blockquote><p>A flaky test is a test that passes most of the time, and sometimes without any apparent reason and without any changes to your app - it fails. This can even happen only on certain machines. For example, on your own machine it always passes, but on a different slower machine, like the CI, it fails.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-we-feel-your-pain">1. We Feel Your Pain<a aria-hidden="true" class="hash-link" href="#1-we-feel-your-pain" title="Direct link to heading">â€‹</a></h3><p>Flakiness is the greatest challenge in E2E. The good news is that Detox was designed with this mission in mind: dealing with flakiness head on.</p><p>Assume you have a suite of 100 tests and each test is flaky in 0.5% of executions (failing without an actual bug in your app). The total flakiness of your entire suite is about 40% (the exact formula is <code>1 - (1 - 0.005)^100</code>). This means that thereâ€™s 40% chance your suite will fail without an actual bug! This makes your entire suite useless.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-sources-of-flakiness">2. Sources of Flakiness<a aria-hidden="true" class="hash-link" href="#2-sources-of-flakiness" title="Direct link to heading">â€‹</a></h3><p>Itâ€™s important to identify the various sources of flakiness in Detox tests.</p><ul><li><p>Control of the device / simulator - in order to run your tests, Detox must communicate with a simulator and instruct it to install the app, restart it, etc. Simulators donâ€™t always behave and controlling them might occasionally fail. Detoxâ€™s underlying simulator control is <a href="https://github.com/wix/AppleSimulatorUtils" target="_blank" rel="noopener noreferrer"><code>AppleSimulatorUtils</code></a>, it is a tool that supports both basic and advanced simulator and device interaction options, it uses some core simulator features which are not always stable and may need time to &quot;warm up&quot; (booting, shutting down, etc.). Detox is set to have a few retries on any of these actions before failing. It will also print all the <code>exec</code> commands when using <code>verbose</code> log level, and with <code>trace</code> level it will print everything.</p></li><li><p>Asynchronous operations inside your app - every time an E2E test runs, operations might take place in a different order inside your app. This makes E2E tests nondeterministic. Consider an HTTP request made to a server, this request may take a variable time to complete due to external concerns like network congestion and server load. Detox takes this into account by monitoring all asynchronous operations that take place in your app from the inside. Detox knows which network requests are currently in-flight. Detox knows how busy the React Native bridge is. Tests are automatically synchronized to the app and only move forward when the app is idle.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="3-get-more-data-about-the-problem">3. Get More Data About the Problem<a aria-hidden="true" class="hash-link" href="#3-get-more-data-about-the-problem" title="Direct link to heading">â€‹</a></h3><p>In order to identify the source of flakiness youâ€™re suffering from you need more data. If you catch a failing test that should be passing, you need to record as much information as possible in order to investigate.</p><ul><li>Enable <code>trace</code> mode in Detox. This will output a lot of information about what happening during the test:<ol><li><code>exec</code> commands</li><li>All communication going over the websocket, both from tester and app</li></ol></li></ul><p>To enable <code>trace</code> mode run your tests in trace log mode:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">detox test --loglevel trace</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wix/Detox/edit/master/docs/../docs/Troubleshooting.Flakiness.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Detox/docs/troubleshooting/synchronization"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Dealing With Synchronization Issues in Tests</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Detox/docs/guide/running-locally"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Running Locally<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dealing-with-flakiness-in-tests" class="table-of-contents__link toc-highlight">Dealing With Flakiness in Tests</a><ul><li><a href="#1-we-feel-your-pain" class="table-of-contents__link toc-highlight">1. We Feel Your Pain</a></li><li><a href="#2-sources-of-flakiness" class="table-of-contents__link toc-highlight">2. Sources of Flakiness</a></li><li><a href="#3-get-more-data-about-the-problem" class="table-of-contents__link toc-highlight">3. Get More Data About the Problem</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Detox/docs/introduction/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/Detox/docs/contributing">Contributing to Detox</a></li></ul></div><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/detox" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Ask a question on Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/wix/Detox/issues/new/choose" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Create new issue on Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/wix/Detox" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/detoxe2e/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/Detox/assets/js/runtime~main.fe902db8.js"></script>
<script src="/Detox/assets/js/main.f7c8efd5.js"></script>
</body>
</html>