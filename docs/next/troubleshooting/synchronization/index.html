<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="search" type="application/opensearchdescription+xml" title="Detox" href="/Detox/opensearch.xml">
<script src="https://platform.twitter.com/widgets.js" async></script><title data-react-helmet="true">Dealing With Synchronization Issues in Tests | Detox</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://wix.github.io/Detox/docs/next/troubleshooting/synchronization"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Dealing With Synchronization Issues in Tests | Detox"><meta data-react-helmet="true" name="description" content="Dealing With Synchronization Issues in Tests"><meta data-react-helmet="true" property="og:description" content="Dealing With Synchronization Issues in Tests"><link data-react-helmet="true" rel="shortcut icon" href="/Detox/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://wix.github.io/Detox/docs/next/troubleshooting/synchronization"><link data-react-helmet="true" rel="alternate" href="https://wix.github.io/Detox/docs/next/troubleshooting/synchronization" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://wix.github.io/Detox/docs/next/troubleshooting/synchronization" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Detox/assets/css/styles.f5627d5b.css">
<link rel="preload" href="/Detox/assets/js/runtime~main.3d11c9f8.js" as="script">
<link rel="preload" href="/Detox/assets/js/main.783f7de0.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="banner_e+xV"><a href="https://stand-with-ukraine.pp.ua" target="_blank" rel="noopener noreferrer" class="link_9Wa8">ðŸ‡ºðŸ‡¦ This project is created with substantial contributions from our Ukrainian colleagues.<!-- --> <span class="hashtag_YjJi">#StandWithUkraine</span></a></div><div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Detox/"><div class="navbar__logo"><img src="/Detox/img/logo.png" alt="Detox Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/Detox/img/logo.png" alt="Detox Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Detox</b></a><a class="navbar__item navbar__link navbar__link--active" href="/Detox/docs/next/introduction/getting-started">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" href="/Detox/docs/next/introduction/getting-started">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Detox/docs/next/troubleshooting/synchronization">Next</a></li><li><a class="dropdown__link" href="/Detox/docs/troubleshooting/synchronization">19.x</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wix/Detox" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Bc3W"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Troubleshooting</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/next/troubleshooting/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/next/troubleshooting/building-the-app">Dealing With Problems With Building the App &amp; Detox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/next/troubleshooting/running-tests">Dealing With Problems With Running Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Detox/docs/next/troubleshooting/synchronization">Dealing With Synchronization Issues in Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Detox/docs/next/troubleshooting/flakiness">Dealing With Flakiness in Tests</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Guides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Detox/docs/next/contributing">Contributing</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Detox<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/Detox/docs/troubleshooting/synchronization">latest version</a></b> (<!-- -->19.x<!-- -->).</div></div><div class="docItemContainer_oiyr"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->Next</span><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Dealing With Synchronization Issues in Tests</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="dealing-with-synchronization-issues-in-tests">Dealing With Synchronization Issues in Tests<a aria-hidden="true" class="hash-link" href="#dealing-with-synchronization-issues-in-tests" title="Direct link to heading">â€‹</a></h2><p>Traditionally, one of the most difficult aspects of E2E testing is synchronizing the test scenario with the app. Complex operations inside the app (like accessing servers or performing animations) often take variable amount of time to complete. We canâ€™t continue the test until theyâ€™ve completed. How can we synchronize the test with these operations?</p><p>Synchronizing manually with <code>sleep()</code> commands is a bad idea. Itâ€™s flaky, complicates the tests, behaves differently on different machines and makes tests needlessly slow.</p><p>Instead, Detox tries to synchronize the test with the app completely <em>automatically</em>.</p><p>When this works itâ€™s like magic. You simply execute actions one after the other without worrying about timing, and Detox waits for the app to stabilize before moving to the next test line. If thereâ€™s an in-flight request to a server, for example, the test will not move forward until the request completes.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="what-operations-do-we-try-to-synchronize-with-automatically">What operations do we try to synchronize with automatically<a aria-hidden="true" class="hash-link" href="#what-operations-do-we-try-to-synchronize-with-automatically" title="Direct link to heading">â€‹</a></h3><ul><li><p><strong>Network requests</strong> - Detox monitors in-flight requests over the network.</p></li><li><p><strong>Main thread (native)</strong> - Detox monitors pending native operations on the main thread (main dispatch queue and main <code>NSOperationQueue</code>).</p></li><li><p><strong>Layout of UI</strong> - Detox monitors UI layout operations. Thereâ€™s also special support for React Native layout which includes the Shadow Queue where <a href="https://github.com/facebook/yoga" target="_blank" rel="noopener noreferrer">yoga</a> runs.</p></li><li><p><strong>Timers</strong> - Detox monitors timers (explicit asynchronous delays). Thereâ€™s special support for JavaScript timers like <code>setTimeout</code> and <code>setInterval</code>.</p></li><li><p><strong>Animations</strong> - Detox monitors active animations and transitions. Thereâ€™s special support for React Native animations with the Animated library.</p></li><li><p><strong>React Native JavaScript thread</strong> - Detox monitors pending operations on the JavaScript thread in RN apps.</p></li><li><p><strong>React Native bridge</strong> - Detox monitors the React Native bridge and asynchronous messages sent on it.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="automatic-synchronization-works-most-of-the-time">Automatic synchronization works most of the time<a aria-hidden="true" class="hash-link" href="#automatic-synchronization-works-most-of-the-time" title="Direct link to heading">â€‹</a></h3><p>Itâ€™s difficult for an automatic mechanism to be correct in 100% of the cases. There are always exceptions. We are optimizing for the common case so most of your scenarios will not have to deal with synchronization issues.</p><p>For the rest of this tutorial, weâ€™ll assume the test is having some sort of synchronization issue.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="are-we-waiting-too-much-or-not-waiting-enough">Are we waiting too much or not waiting enough?<a aria-hidden="true" class="hash-link" href="#are-we-waiting-too-much-or-not-waiting-enough" title="Direct link to heading">â€‹</a></h3><p>When the automatic synchronization mechanism doesnâ€™t work, we have 2 potential problems:</p><ul><li><p>We are waiting too much - The test will appear to hang and fail with timeout. This happens because Detox thinks an asynchronous operation is currently taking place and is waiting for it endlessly.</p></li><li><p>We are not waiting enough - The test will appear to fail at some point because an element isnâ€™t found according to an expectation or isnâ€™t found when attempting to perform an action on it. This happens because Detox didnâ€™t take some asynchronous operation into account and isnâ€™t waiting until it completes.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="identifying-which-synchronization-mechanism-causes-us-to-wait-too-much">Identifying which synchronization mechanism causes us to wait too much<a aria-hidden="true" class="hash-link" href="#identifying-which-synchronization-mechanism-causes-us-to-wait-too-much" title="Direct link to heading">â€‹</a></h3><p>Interactions with the application are synchronized, meaning that they will not execute unless the app is idle. You may encounter situations where the tests just hang.
When an action/expectation takes a significant amount of time use this option to print device synchronization status.
The status will be printed if the action takes more than <!-- -->[<!-- -->value] (in ms) to complete</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI sh"><pre tabindex="0" class="prism-code language-sh codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">detox test --debug-synchronization 500</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Then, reproduce your issue, and you should see output similar to the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI plain"><pre tabindex="0" class="prism-code language-plain codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">detox[9733] INFO:  [APP_STATUS] The app is busy with the following tasks:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â€¢ There are 1 work items pending on the dispatch queue: &quot;Main Queue (&lt;OS_dispatch_queue_main: com.apple.main-thread&gt;)&quot;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â€¢ Run loop &quot;Main Run Loop&quot; is awake.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â€¢ 1 enqueued native timers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Timer #1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    + Fire date: 2021-11-11 14:19:57 +0200.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    + Time until fire: 0.072.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    + Repeat interval: 0.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    + Is recurring: NO.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>See <a href="https://github.com/wix/DetoxSync/blob/master/StatusDocumentation.md" target="_blank" rel="noopener noreferrer">this document</a> for documentation of the debug synchronization output.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="lower-level-idling-resources-debug-ios-only">Lower-level Idling Resources Debug (iOS Only)<a aria-hidden="true" class="hash-link" href="#lower-level-idling-resources-debug-ios-only" title="Direct link to heading">â€‹</a></h4><p>If <code>--debug-synchronization</code> does not provide the necessary information, on iOS you can add the following launch argument to your app (using <code>launchArgs</code> in your <code>launchApp()</code> call) to enable a very verbose logging of the idling resource system to the system log:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">-DTXEnableVerboseSyncSystem YES -DTXEnableVerboseSyncResources YES</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can then obtain this log by running the following command:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">xcrun simctl spawn booted log stream --level debug --style compact --predicate </span><span class="token string" style="color:#e3116c">&quot;category==&#x27;SyncManager&#x27;&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>For example, change your <code>/e2e/init.js</code> like so:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> detox</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">launchApp</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">launchApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">newInstance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">launchArgs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">&#x27;DTXEnableVerboseSyncSystem&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;YES&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string-property property" style="color:#36acaa">&#x27;DTXEnableVerboseSyncResources&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;YES&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="switching-to-manual-synchronization-as-a-workaround">Switching to manual synchronization as a workaround<a aria-hidden="true" class="hash-link" href="#switching-to-manual-synchronization-as-a-workaround" title="Direct link to heading">â€‹</a></h3><p>We always have the fail-safe of turning off automatic synchronization and waiting manually by ourselves. This isnâ€™t the recommended approach, but sometimes we donâ€™t have a choice.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="how-do-we-turn-off-automatic-synchronization">How do we turn off automatic synchronization?<a aria-hidden="true" class="hash-link" href="#how-do-we-turn-off-automatic-synchronization" title="Direct link to heading">â€‹</a></h4><p>This makes sense only if weâ€™re waiting too much.</p><h5 class="anchor anchorWithStickyNavbar_y2LR" id="controlling-the-entire-synchronization-mechanism"><a href="https://github.com/wix/detox/blob/master/docs/APIRef.DeviceObjectAPI.md#devicedisablesynchronization" target="_blank" rel="noopener noreferrer">Controlling the entire synchronization mechanism</a><a aria-hidden="true" class="hash-link" href="#controlling-the-entire-synchronization-mechanism" title="Direct link to heading">â€‹</a></h5><p>The synchronization mechanism can be shut down using</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">disableSynchronization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>to turn it on again use</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">enableSynchronization</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_y2LR" id="controlling-network-synchronization"><a href="https://github.com/wix/detox/blob/master/docs/APIRef.DeviceObjectAPI.md#deviceseturlblacklisturls" target="_blank" rel="noopener noreferrer">Controlling network synchronization</a><a aria-hidden="true" class="hash-link" href="#controlling-network-synchronization" title="Direct link to heading">â€‹</a></h5><p>You can skip over synchronizing on certain URLs (for long polling tasks, or websocket connections)</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setURLBlacklist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;.*127.0.0.1.*&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In order to gain sync back on an endpoint, just remove it from the blacklist:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setURLBlacklist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Alternatively, you can launch your app already with the URL blacklist defined â€” that can help with a network sync issue at the very beginning:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">launchApp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">launchArgs</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">detoxURLBlacklistRegex</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;(&quot;.*example.com/some-url/.*&quot;)&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="how-do-we-wait-manually">How do we wait manually?<a aria-hidden="true" class="hash-link" href="#how-do-we-wait-manually" title="Direct link to heading">â€‹</a></h4><p>This makes sense only if weâ€™re not waiting enough (or if weâ€™ve disabled automatic synchronization). Use the <code>withTimeout()</code> API to wait until an expectation is met. The API is documented <a href="/Detox/docs/next/api/expect#withtimeouttimeout">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="tweaking-and-fine-tuning-the-synchronization-mechanisms">Tweaking and fine-tuning the synchronization mechanisms<a aria-hidden="true" class="hash-link" href="#tweaking-and-fine-tuning-the-synchronization-mechanisms" title="Direct link to heading">â€‹</a></h3><blockquote><p>This isnâ€™t exposed yet, to be done...</p></blockquote><h3 class="anchor anchorWithStickyNavbar_y2LR" id="modifying-your-app-to-avoid-waiting-too-much">Modifying your app to avoid waiting too much<a aria-hidden="true" class="hash-link" href="#modifying-your-app-to-avoid-waiting-too-much" title="Direct link to heading">â€‹</a></h3><p>When facing a synchronization issue and tweaking doesnâ€™t help, consider modifying your app. When Detox is having trouble synchronizing due to intense non-stopping activity, it may be a sign that your app is abusing resources.</p><p>You can also modify your app, for the sake of tests only, by using mocking. Read more <a href="https://github.com/wix/Detox/blob/master/docs/Guide.Mocking.md" target="_blank" rel="noopener noreferrer">here</a>.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="settimeout-and-setinterval"><code>setTimeout</code> and <code>setInterval</code><a aria-hidden="true" class="hash-link" href="#settimeout-and-setinterval" title="Direct link to heading">â€‹</a></h4><p>By default, Detox is designed to ignore <code>setInterval</code> and will only wait for <code>setTimeout</code> of up to 1.5 seconds. If you have an endless polling loop with short intervals implemented with <code>setTimeout</code>, switch the implementation to <code>setInterval</code>. If possible, avoid aggressive polling in your app altogether, the poor single JavaScript thread we have doesnâ€™t like it.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="endless-looping-animations">Endless looping animations<a aria-hidden="true" class="hash-link" href="#endless-looping-animations" title="Direct link to heading">â€‹</a></h4><p>By default, Detox will wait until animations complete. If you have an endless looping animation, this may cause Detox to hang. In this case, consider turning off the animation synchronization or remove the endless loop in your E2E build with <a href="https://github.com/wix/Detox/blob/master/docs/Guide.Mocking.md" target="_blank" rel="noopener noreferrer">mocking</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/wix/Detox/edit/master/docs/../docs/Troubleshooting.Synchronization.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Detox/docs/next/troubleshooting/running-tests"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Dealing With Problems With Running Tests</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Detox/docs/next/troubleshooting/flakiness"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Dealing With Flakiness in Tests<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dealing-with-synchronization-issues-in-tests" class="table-of-contents__link toc-highlight">Dealing With Synchronization Issues in Tests</a><ul><li><a href="#what-operations-do-we-try-to-synchronize-with-automatically" class="table-of-contents__link toc-highlight">What operations do we try to synchronize with automatically</a></li><li><a href="#automatic-synchronization-works-most-of-the-time" class="table-of-contents__link toc-highlight">Automatic synchronization works most of the time</a></li><li><a href="#are-we-waiting-too-much-or-not-waiting-enough" class="table-of-contents__link toc-highlight">Are we waiting too much or not waiting enough?</a></li><li><a href="#identifying-which-synchronization-mechanism-causes-us-to-wait-too-much" class="table-of-contents__link toc-highlight">Identifying which synchronization mechanism causes us to wait too much</a></li><li><a href="#switching-to-manual-synchronization-as-a-workaround" class="table-of-contents__link toc-highlight">Switching to manual synchronization as a workaround</a></li><li><a href="#tweaking-and-fine-tuning-the-synchronization-mechanisms" class="table-of-contents__link toc-highlight">Tweaking and fine-tuning the synchronization mechanisms</a></li><li><a href="#modifying-your-app-to-avoid-waiting-too-much" class="table-of-contents__link toc-highlight">Modifying your app to avoid waiting too much</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Detox/docs/introduction/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/Detox/docs/contributing">Contributing to Detox</a></li></ul></div><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/detox" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Ask a question on Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/wix/Detox/issues/new/choose" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Create new issue on Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/wix/Detox" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/detoxe2e/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discord.gg/CkD5QKheF5" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/Detox/assets/js/runtime~main.3d11c9f8.js"></script>
<script src="/Detox/assets/js/main.783f7de0.js"></script>
</body>
</html>