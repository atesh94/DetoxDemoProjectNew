# Logger

TODO: rewrite this document

## Methods

- [`detox.traceCall()`](#detoxtracecall)
- [`detox.trace.startSection(), detox.trace.endSection()`](#detoxtracestartsection-detoxtraceendsection)

```js
it('Verify sanity things', async () => {
  try {
    detox.trace.startSection('Turn off notifications');
    await element(by.id('gotoNotifications')).tap();
    await element(by.id('notificationsToggle')).tap();
    await device.pressBack();
  } finally {
    detox.trace.endSection('Turn off notifications');
  }
});
```

Effectively, `start` and `end` can even be called in two complete different places - such as a `before` and an `after`. But that is discouraged. In fact, **usage of `detox.traceCall()` is the recommended way of tracing things, altogether.**

### Timeline Plugin

When enabled using the `--record-timeline all` argument to Detox, the time-line of the entire testing session is recorded, based on trace calls made by Detox internally, and explicit calls made in user test-code, combined.
The final outcome is a JSON-like file named `detox.trace.json`, which, if loaded into a Chrome-browser tab with the `chrome://tracing` URL, would look something like this:

![Timeline artifact example](../img/timeline-artifact.png)

This _tracing_ view provides a visual, hierarchical representation of the various processes that took place during the execution of the testing session, over the execution’s _time-line_. These processes appear as hierarchical _sections_ – sometimes visually ordered in a parent-child way, depending on their formation time and context.
To name a few predefined events, which are generated by Detox itself:

- **`detoxInit`:** Initialization of Detox, prior to running the suites associated with a specific tests file.
- **`awaitBoot`:** Waiting for an emulator to complete booting (thus being ready to run tests). Done in the surrounding context of `detoxInit` (and hence visually appears "below" it), as waiting for emulators' boot is an inherent part of Detox' initialization.
- **`appInstall`**, **`appUninstall`**.
- **"Sanity":** Execution of a user test suite called _Sanity_.
- **`reloadRN`:** A dynamic reload of the React-Native. Bound to calls to `device.reloadReactNative()`, specifically.

In the above example, the following can be observed:

1. There were 2 test workers (the Worker #⁠1, Worker #⁠2 time-lines) executing a total of two test suites.
1. There were 2 Android emulators used for running the test session, namely `emulator-17800` and `emulator-12466`. They were used by worker 1 and worker 2, respectively.
1. It took about a total of 54 seconds to initialize and run all the tests.
1. The first worker took longer to initialize (as depicted by the `detoxInit` section). In particular, that happened because it took longer for the associated emulator too finish bootstrapping (see the child `awaitBoot` section). That suggests there might be a problem with the test execution environment.

### Purpose

**This artifact can be helpful in looking up ways to optimize the execution of your E2E tests.** It may surface shortcomings in the test environment’s ability to run the test, or provide a means to consider different ways of splitting up your tests over test files so as to better utilize parallelism.

The artifact can in fact be even better utilized – to the level of inspecting the inside of your tests, by explicitly calling `trace` via the `detox.traceCall()` and `detox.trace.startSection()`, `detox.trace.endSection()` [APIs](#detoxtracecall) inside your tests.
