"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2443],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var s=n.createContext({}),c=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),d=c(r),m=i,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||a;return r?n.createElement(k,l(l({ref:t},p),{},{components:r})):n.createElement(k,l({ref:t},p))}));function m(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,l=new Array(a);l[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var c=2;c<a;c++)l[c]=r[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},658:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>c});var n=r(7462),i=(r(7294),r(3905));const a={id:"parallel-test-execution",slug:"guide/parallel-test-execution",title:"Parallel Test Execution",sidebar_label:"Parallel Test Execution"},l=void 0,o={unversionedId:"parallel-test-execution",id:"parallel-test-execution",title:"Parallel Test Execution",description:"Parallel Test Execution",source:"@site/../docs/Guide.ParallelTestExecution.md",sourceDirName:".",slug:"/guide/parallel-test-execution",permalink:"/Detox/docs/next/guide/parallel-test-execution",draft:!1,editUrl:"https://github.com/wix/Detox/edit/master/docs/../docs/Guide.ParallelTestExecution.md",tags:[],version:"current",frontMatter:{id:"parallel-test-execution",slug:"guide/parallel-test-execution",title:"Parallel Test Execution",sidebar_label:"Parallel Test Execution"},sidebar:"tutorialSidebar",previous:{title:"Mocha Setup Guide",permalink:"/Detox/docs/next/guide/mocha"},next:{title:"Third-Party Drivers",permalink:"/Detox/docs/next/guide/third-party-drivers"}},s={},c=[{value:"Parallel Test Execution",id:"parallel-test-execution",level:2},{value:"Device Creation",id:"device-creation",level:3},{value:"Lock File",id:"lock-file",level:3},{value:"Persisting the Lock File",id:"persisting-the-lock-file",level:4}],p={toc:c};function u(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"parallel-test-execution"},"Parallel Test Execution"),(0,i.kt)("p",null,"Detox can leverage multi worker support of JS test runners (",(0,i.kt)("a",{parentName:"p",href:"http://jestjs.io/docs/en/cli#maxworkers-num"},"Jest"),", ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/avajs/ava#process-isolation"},"AVA"),", etc.)."),(0,i.kt)("p",null,"By default ",(0,i.kt)("inlineCode",{parentName:"p"},"detox test")," will run the test runner with one worker (it will pass ",(0,i.kt)("inlineCode",{parentName:"p"},"--maxWorkers=1")," to Jest CLI, Mocha is unaffected). Worker count can be controlled by adding ",(0,i.kt)("inlineCode",{parentName:"p"},"--workers n")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"detox test"),", read more in ",(0,i.kt)("a",{parentName:"p",href:"/Detox/docs/next/api/detox-cli#test"},(0,i.kt)("inlineCode",{parentName:"a"},"detox-cli")," section"),"."),(0,i.kt)("h3",{id:"device-creation"},"Device Creation"),(0,i.kt)("p",null,"While running with multiple workers, Detox might not have an available simulator for every worker.\nIf no simulator is available for that worker, the worker will create one with the name ",(0,i.kt)("inlineCode",{parentName:"p"},"{name}-Detox"),"."),(0,i.kt)("h3",{id:"lock-file"},"Lock File"),(0,i.kt)("p",null,"Simulators/emulators run on a different process, outside of node, and require some sort of lock mechanism to make sure only one process controls a simulator in a given time. Therefore, Detox 7.4.0 introduced ",(0,i.kt)("inlineCode",{parentName:"p"},"device.registry.state.lock"),", a lock file controlled by Detox, that registers all in-use simulators."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Note:")," Each worker is responsible for removing the device ID from the list in ",(0,i.kt)("inlineCode",{parentName:"p"},"device.registry.state.lock"),". Exiting a test runner abruptly (using ",(0,i.kt)("inlineCode",{parentName:"p"},"Ctrl+C")," / ",(0,i.kt)("inlineCode",{parentName:"p"},"\u2318+C"),") will not give the worker a chance to unregister the device from the lock file, resulting in an inconsistent state, which can result in creation of unnecessary new simulators."),(0,i.kt)("ul",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"detox-cli")," makes sure ",(0,i.kt)("inlineCode",{parentName:"p"},"device.registry.state.lock")," is cleaned whenever it executes.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"If you use Detox without ",(0,i.kt)("inlineCode",{parentName:"p"},"detox-cli")," make sure you delete or reset the lock file before running tests."),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'echo "[]" > ~/Library/Detox/device.registry.state.lock\n'))))),(0,i.kt)("p",null,"The lock file location is determined by the OS, and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/wix/detox/blob/master/detox/src/utils/appdatapath.js"},"defined here"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"MacOS"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"~/Library/Detox/device.registry.state.lock")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Linux"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"~/.local/share/Detox/device.registry.state.lock")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Windows"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"%LOCALAPPDATA%/data/Detox/device.registry.state.lock")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"%USERPROFILE%/Application Data/Detox/device.registry.state.lock"))),(0,i.kt)("h4",{id:"persisting-the-lock-file"},"Persisting the Lock File"),(0,i.kt)("p",null,"By default, once all workers finish their test runs, Detox will delete the lock file. Under certain conditions, you may want to persist the lock file. Use the ",(0,i.kt)("inlineCode",{parentName:"p"},"--keepLockFile")," flag to disable automatic deletion."))}u.isMDXComponent=!0}}]);