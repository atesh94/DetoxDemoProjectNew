"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6886],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return c}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(n),c=i,h=m["".concat(s,".").concat(c)]||m[c]||u[c]||o;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4526:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},toc:function(){return d},default:function(){return m}});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],l={id:"migration",slug:"guide/migration",title:"Migration Guide",sidebar_label:"Migration Guide"},s=void 0,p={unversionedId:"migration",id:"migration",isDocsHomePage:!1,title:"Migration Guide",description:"Migration Guide",source:"@site/../docs/Guide.Migration.md",sourceDirName:".",slug:"/guide/migration",permalink:"/Detox/docs/guide/migration",editUrl:"https://github.com/wix/Detox/edit/master/docs/../docs/Guide.Migration.md",tags:[],version:"current",frontMatter:{id:"migration",slug:"guide/migration",title:"Migration Guide",sidebar_label:"Migration Guide"},sidebar:"tutorialSidebar",previous:{title:"Mocking",permalink:"/Detox/docs/guide/mocking"},next:{title:"Jest Setup Guide",permalink:"/Detox/docs/guide/jest"}},d=[{value:"Migration Guide",id:"migration-guide",children:[{value:"19.0",id:"190",children:[{value:"Migrating Custom Drivers",id:"migrating-custom-drivers",children:[{value:"How to migrate",id:"how-to-migrate",children:[],level:5},{value:"Troubleshooting",id:"troubleshooting",children:[],level:5}],level:4}],level:3},{value:"18.6.0",id:"1860",children:[],level:3},{value:"18.0",id:"180",children:[],level:3},{value:"17.5.2",id:"1752",children:[],level:3},{value:"17.4.7",id:"1747",children:[{value:"<code>jest-cli</code>",id:"jest-cli",children:[],level:4},{value:"<code>detox-cli</code>",id:"detox-cli",children:[],level:4}],level:3},{value:"17.3.0",id:"1730",children:[],level:3},{value:"17.0.0",id:"1700",children:[{value:"New API",id:"new-api",children:[],level:4},{value:"Modified API (<strong>Potentially Breaking Changes</strong>)",id:"modified-api-potentially-breaking-changes",children:[],level:4},{value:"Deprecated API",id:"deprecated-api",children:[],level:4}],level:3},{value:"16.0.0",id:"1600",children:[],level:3},{value:"14.5.0",id:"1450",children:[],level:3},{value:"14.0.0",id:"1400",children:[],level:3},{value:"Migrating to 12.7.0 from older (nonbreaking)",id:"migrating-to-1270-from-older-nonbreaking",children:[],level:3},{value:"Migrating from Detox 12.4.x to 12.5.0 (nonbreaking)",id:"migrating-from-detox-124x-to-1250-nonbreaking",children:[{value:"ProGuard Configuration",id:"proguard-configuration",children:[],level:4}],level:3},{value:"Migrating from Detox 12.3.x to 12.4.0",id:"migrating-from-detox-123x-to-1240",children:[],level:3},{value:"Migrating from Detox 12.0.x to 12.1.x",id:"migrating-from-detox-120x-to-121x",children:[],level:3},{value:"Migrating from Detox 11.0.1 to 12.0.0",id:"migrating-from-detox-1101-to-1200",children:[],level:3},{value:"Migrating from Detox 11.0.0 to 11.0.1 (nonbreaking)",id:"migrating-from-detox-1100-to-1101-nonbreaking",children:[],level:3},{value:"Migrating from Detox 10.x.x to 11.x.x",id:"migrating-from-detox-10xx-to-11xx",children:[{value:"Step 1",id:"step-1",children:[],level:4},{value:"Step 2",id:"step-2",children:[],level:4}],level:3},{value:"Migrating from Detox 9.x.x to 10.x.x",id:"migrating-from-detox-9xx-to-10xx",children:[],level:3},{value:"Migrating from Detox 8.x.x to 9.x.x",id:"migrating-from-detox-8xx-to-9xx",children:[],level:3},{value:"Migrating from Detox 7.x.x to 8.x.x",id:"migrating-from-detox-7xx-to-8xx",children:[{value:"Changes to <code>e2e/init.js</code>",id:"changes-to-e2einitjs",children:[{value:"<em>Mocha</em>",id:"mocha",children:[],level:5},{value:"<em>Jest</em>",id:"jest",children:[],level:5},{value:"Note regarding <code>detox.beforeEach</code> and <code>detox.afterEach</code>",id:"note-regarding-detoxbeforeeach-and-detoxaftereach",children:[],level:5},{value:"Changes to <code>detox test</code> CLI",id:"changes-to-detox-test-cli",children:[],level:5}],level:4}],level:3},{value:"Migrating from Detox 4.x.x to 5.x.x",id:"migrating-from-detox-4xx-to-5xx",children:[{value:"Version 5.x.x breaks detox\u2019s API in 4 different places",id:"version-5xx-breaks-detoxs-api-in-4-different-places",children:[{value:"1. Promise based flow",id:"1-promise-based-flow",children:[],level:5},{value:"2. <code>detox</code> object has a leaner API",id:"2-detox-object-has-a-leaner-api",children:[],level:5},{value:"3. <code>simulator</code> is now <code>device</code>",id:"3-simulator-is-now-device",children:[],level:5},{value:"4. Detox config scheme",id:"4-detox-config-scheme",children:[],level:5},{value:"3.1 Start using <code>detox-cli</code>",id:"31-start-using-detox-cli",children:[],level:5}],level:4}],level:3},{value:"Migrating from Detox 3.x.x to 4.x.x",id:"migrating-from-detox-3xx-to-4xx",children:[],level:3}],level:2}],u={toc:d};function m(e){var t=e.components,n=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"migration-guide"},"Migration Guide"),(0,o.kt)("p",null,"We are improving Detox API as we go along, sometimes these changes require us to break the API in order for it to make more sense. These migration guides refer to breaking changes. If a newer version has no entries in this document, it means it does not require special migration steps. Refer to the release notes of the later builds to learn about their improvements and changes."),(0,o.kt)("h3",{id:"190"},"19.0"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Version 19 is not really a breaking change!")),(0,o.kt)("p",null,"We decided to bump Detox into a major version release, nonetheless, because it is breaking for projects that sport ",(0,o.kt)("a",{parentName:"p",href:"/Detox/docs/guide/third-party-drivers"},"custom Detox drivers"),", such as ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer"},(0,o.kt)("inlineCode",{parentName:"a"},"detox-puppeteer")),"."),(0,o.kt)("p",null,"If you are a maintainer of such a project and you wish to upgrade your Detox dependency to 19 (kudos! \ud83d\udc4f),  follow this step-by-step migration guide; You can refer to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer/pull/13"},"this pull-request"),", which does that for the  ",(0,o.kt)("inlineCode",{parentName:"p"},"detox-puppeteer")," project."),(0,o.kt)("h4",{id:"migrating-custom-drivers"},"Migrating Custom Drivers"),(0,o.kt)("p",null,"The core of the change is that Detox' drivers framework is ",(0,o.kt)("strong",{parentName:"p"},"no longer a single monolith"),", responsible for everything platform-specific. Rather, it\u2019s been broken down to these subresponsibilies:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Allocation: The process of launching / selecting a device over which the tests would run in the current execution."),(0,o.kt)("li",{parentName:"ul"},"Validation: Execution environment checkups."),(0,o.kt)("li",{parentName:"ul"},"Artifacts: Platform-based selection of build-artifacts implementation (e.g. screenshots)."),(0,o.kt)("li",{parentName:"ul"},"Runtime")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"You can find a visual explanation, ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/files/7338121/pre-multiapps-rfc.pdf"},"here"),".")),(0,o.kt)("p",null,"In addition, the runtime driver is no longer state-less -- basically, allowing implementation to hold any state that is required in identifying and managing the associated device."),(0,o.kt)("h5",{id:"how-to-migrate"},"How to migrate"),(0,o.kt)("p",null,"Everything here will be based on the changes made in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer"},(0,o.kt)("inlineCode",{parentName:"a"},"detox-puppeteer")," example")," - names included (please don\u2019t use them as-is in your own implementation!)."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Allocation:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create a new class, called ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerDeviceAllocation")," (change name to something that would make sense in your project)."),(0,o.kt)("li",{parentName:"ul"},"Move everything currently in ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver.acquireFreeDevice()")," and ",(0,o.kt)("inlineCode",{parentName:"li"},".shutdown()")," onto ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerDeviceAllocation.allocate()")," and ",(0,o.kt)("inlineCode",{parentName:"li"},".free()"),", respectively."),(0,o.kt)("li",{parentName:"ul"},"Create a POJO class called ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerAllocCookie"),". This class should hold anything that would later be required in order to specify the specifically associated device (example: ",(0,o.kt)("inlineCode",{parentName:"li"},"UDID")," for iOS simulators, ",(0,o.kt)("inlineCode",{parentName:"li"},"adb")," names for Android devices)."),(0,o.kt)("li",{parentName:"ul"},"Make ",(0,o.kt)("inlineCode",{parentName:"li"},".allocate()")," return an instance of your cookie class. Puppeteer example: ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/ouihealth/detox-puppeteer/pull/13/files#diff-818f6c5309fffe5c710e542216ffdb55f468fd2f8035feb0b0c917785489aca7R841"},"here"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Delete ",(0,o.kt)("inlineCode",{parentName:"strong"},"PuppeteerDriver.acquireFreeDevice()")," and ",(0,o.kt)("inlineCode",{parentName:"strong"},"PuppeteerDriver.shutdown()"),"."))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"For a precise class c'tor and method signatures, see ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer/pull/13/files#diff-818f6c5309fffe5c710e542216ffdb55f468fd2f8035feb0b0c917785489aca7R830"},"here"),".")),(0,o.kt)("p",null,"Add the new allocation class to the ",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports")," list, under the name: ",(0,o.kt)("inlineCode",{parentName:"p"},"DeviceAllocationDriverClass"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Validation:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If you have any validations implemented in ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver.prepare()"),", create a class called ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerEnvironmentValidator"),"."),(0,o.kt)("li",{parentName:"ul"},"Move anything inside ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver.prepare()")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerEnvironmentValidator.validate()"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Delete ",(0,o.kt)("inlineCode",{parentName:"strong"},"PupeteerDriver.prepare()"),"."))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"For a precise class c'tor and method signatures, see ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ouihealth/detox-puppeteer/pull/13/files#diff-818f6c5309fffe5c710e542216ffdb55f468fd2f8035feb0b0c917785489aca7R798"},"here"),".")),(0,o.kt)("p",null,"Add the new (optional) class to the ",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports")," list, under the name: ",(0,o.kt)("inlineCode",{parentName:"p"},"EnvironmentValidatorClass"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Artifacts:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Move your implementation of ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver.declareArtifactPlugins()")," to the same method in a new class, called ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerArtifactPluginsProvider.declareArtifactPlugins()")," (change name to something that would make sense in your project).")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"There are no changes in method signature in this case.")),(0,o.kt)("p",null,"Add the new class to the ",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports")," list, under the name: ",(0,o.kt)("inlineCode",{parentName:"p"},"ArtifactPluginsProviderClass"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Runtime:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Optionally rename your class from ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerDriver")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerRuntimeDriver"),"."),(0,o.kt)("li",{parentName:"ul"},"In the methods remaining in the class accepting the ",(0,o.kt)("inlineCode",{parentName:"li"},"deviceId")," arg: ",(0,o.kt)("strong",{parentName:"li"},"remove the ",(0,o.kt)("inlineCode",{parentName:"strong"},"deviceId")," arg entirely"),". This might break your implementation - don\u2019t worry, continue reading."),(0,o.kt)("li",{parentName:"ul"},"If applicable, change the signature of the class' c'tor to accept the cookie as it\u2019s 2nd argument (instance previously allocated in ",(0,o.kt)("inlineCode",{parentName:"li"},"PuppeteerAllocationDriver.allocate()"),"). Save data from the cookie as part of the driver\u2019s state, in order to unbreak your implementation, following the previous step."),(0,o.kt)("li",{parentName:"ul"},"Add two methods: ",(0,o.kt)("inlineCode",{parentName:"li"},"getExternalId()")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"getDeviceName()"),". Implement them such that they would comply with the ",(0,o.kt)("inlineCode",{parentName:"li"},"device.id")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"device.name")," ",(0,o.kt)("a",{parentName:"li",href:"/Detox/docs/api/device-object-api"},"API contracts"),", respectively.")),(0,o.kt)("p",null,"Export the runtime driver class in the ",(0,o.kt)("inlineCode",{parentName:"p"},"module.exports")," list as ",(0,o.kt)("inlineCode",{parentName:"p"},"RuntimeDriverClass"),", ",(0,o.kt)("strong",{parentName:"p"},"instead of ",(0,o.kt)("inlineCode",{parentName:"strong"},"DriverClass"),".")),(0,o.kt)("h5",{id:"troubleshooting"},"Troubleshooting"),(0,o.kt)("p",null,"For issue related to these migrations, approach us by ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/new/choose"},"submitting an issue on GitHub"),". Please apply the ",(0,o.kt)("inlineCode",{parentName:"p"},"Detox19")," label."),(0,o.kt)("h3",{id:"1860"},"18.6.0"),(0,o.kt)("p",null,"Detox has normalized the configuration format, so that along with the combined ",(0,o.kt)("inlineCode",{parentName:"p"},"configurations")," object you now can define your ",(0,o.kt)("inlineCode",{parentName:"p"},"devices")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"apps")," separately.\nPlease refer to the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/blob/18.6.0/docs/APIRef.Configuration.md"},"configuration doc")," to obtain more details.\nThis change is backward-compatible, although the new format is now the recommended option."),(0,o.kt)("h3",{id:"180"},"18.0"),(0,o.kt)("p",null,"Detox now uses a custom synchronization system on iOS, ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/DetoxSync"},"developed in-house"),"; this is the second step in phasing out our Earl Grey usage. We have tested this system extensively internally, and are confident that it should work as expected. There are no known limitations with the new system."),(0,o.kt)("p",null,"If you are seeing issues with the new sync system, please open an issue."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Breaking:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"iOS.")," Detox now requires iOS 13.0 and above iOS simulator runtimes, and iOS 12.x and below are no longer supported. This does not require that you drop support for iOS 12.x in your apps, just that tests will no longer work on iOS 12 and below. Please make sure your tests are running on iOS 13 or above"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"JS.")," \u26a0\ufe0f Detox no longer launches the app automatically (even if asked to do so in configuration) \u2014 you have to launch your app explicitly:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"+  beforeAll(async () => {\n+    await device.launchApp();\n+  });\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"JS (jest-circus).")," The ",(0,o.kt)("inlineCode",{parentName:"li"},"DetoxCircusEnvironment")," provided from ",(0,o.kt)("inlineCode",{parentName:"li"},"detox/runners/jest-circus")," package now requires two arguments in its constructor, so you have to update your descendant class signature:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"class CustomDetoxEnvironment extends DetoxCircusEnvironment {\n-  constructor(config) {\n-    super(config);\n+  constructor(config, context) {\n+    super(config, context);\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"JS (iOS).")," ",(0,o.kt)("inlineCode",{parentName:"li"},"device.launchApp({ launchArgs: { ... })")," argument escaping has been improved. If you use complex launch args such as regular expressions, make sure you remove manual escaping from now on to avoid erroneous double escaping, e.g.:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"}," await device.launchApp({\n   launchArgs: {\n-    detoxURLBlacklistRegex: '(\\\\\".*example.com/some-url/.*\\\\\")' }`,\n+    detoxURLBlacklistRegex: '(\".*example.com/some-url/.*\")' }`,\n   },\n });\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"JS (internal).")," There is a breaking change for people writing custom Detox integrations. Environment variable naming schema has changed \u2013 now Detox uses prefix to distinguish its own environment variables (usually passed from ",(0,o.kt)("inlineCode",{parentName:"li"},"detox test")," CLI), e.g.: ",(0,o.kt)("inlineCode",{parentName:"li"},"recordLogs=all")," becomes ",(0,o.kt)("inlineCode",{parentName:"li"},"DETOX_RECORD_LOGS=all"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"loglevel=trace")," becomes ",(0,o.kt)("inlineCode",{parentName:"li"},"DETOX_LOGLEVEL=trace"),", and so on.")),(0,o.kt)("h3",{id:"1752"},"17.5.2"),(0,o.kt)("p",null,"Fixes the issue from ",(0,o.kt)("strong",{parentName:"p"},"17.4.7")," (see below) - now the migration guide for ",(0,o.kt)("strong",{parentName:"p"},"17.4.7")," can be safely ignored."),(0,o.kt)("h3",{id:"1747"},"17.4.7"),(0,o.kt)("p",null,"This release was not meant to be breaking in any sense, but unfortunately there are two minor caveats that leaked in."),(0,o.kt)("h4",{id:"jest-cli"},(0,o.kt)("inlineCode",{parentName:"h4"},"jest-cli")),(0,o.kt)("p",null,"From now on, Detox explicitly depends on ",(0,o.kt)("inlineCode",{parentName:"p"},"jest-cli")," package (marked as a peer dependency), that\u2019s why if you see an error like the one below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"Cannot find module 'jest-cli/build/cli/args'\n")),(0,o.kt)("p",null,(0,o.kt)("del",{parentName:"p"},"You should add ",(0,o.kt)("inlineCode",{parentName:"del"},"jest-cli")," to your ",(0,o.kt)("inlineCode",{parentName:"del"},"package.json"),"\u2019s ",(0,o.kt)("inlineCode",{parentName:"del"},"devDependencies")," and rerun ",(0,o.kt)("inlineCode",{parentName:"del"},"npm install"),", e.g.:")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"UPD"),": since ",(0,o.kt)("inlineCode",{parentName:"p"},"detox@17.5.2")," you can ignore this advice. The problem should go away ",(0,o.kt)("strong",{parentName:"p"},"without")," these edits:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},' "devDependencies": {\n   "jest": "26.x.x",\n+  "jest-cli": "26.x.x",\n')),(0,o.kt)("h4",{id:"detox-cli"},(0,o.kt)("inlineCode",{parentName:"h4"},"detox-cli")),(0,o.kt)("p",null,"If you were using ",(0,o.kt)("inlineCode",{parentName:"p"},"detox-cli")," global package, make sure to upgrade it before proceeding to ",(0,o.kt)("inlineCode",{parentName:"p"},"detox@17.4.7"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"npm -g install detox-cli\n")),(0,o.kt)("p",null,"If you have an older version of ",(0,o.kt)("inlineCode",{parentName:"p"},"detox-cli"),", then you might see the following error on an attempt to run  ",(0,o.kt)("inlineCode",{parentName:"p"},"detox test <...args>"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"'jest' is not recognized as an internal or external command,\noperable program or batch file.\ndetox[43764] ERROR: [cli.js] Error: Command failed: jest --config e2e/config.json --testNamePattern \"^((?!:android:).)*$\" --maxWorkers 1 e2e\n")),(0,o.kt)("h3",{id:"1730"},"17.3.0"),(0,o.kt)("p",null,"In the context of introducing the element screenshots feature (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/2012"},"#2012"),"), we decided to slightly change the contract between Detox and externally-implemented ",(0,o.kt)("em",{parentName:"p"},"drivers"),". These should be modified according to the follow diff-snippet:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"class Expect {\n-  constructor(invocationManager) {\n+  constructor({ invocationManager }) {\n     this._invocationManager = invocationManager;\n  }\n}\n\nclass PluginDriver {\n  constructor() {\n-    this.matchers = new Expect(new invocationManager());\n  }\n}\n\n-module.exports = PluginDriver;\n+module.exports = {\n+  DriverClass: PluginDriver,\n+  ExpectClass: Expect,\n+}\n")),(0,o.kt)("h3",{id:"1700"},"17.0.0"),(0,o.kt)("p",null,"Detox for iOS now uses an entirely new, custom built matcher, action and expectation infrastructure. This is the first step in our roadmap of removing Earl Grey as a dependency."),(0,o.kt)("p",null,"While the new system has been designed to be as compatible as possible with the existing system, some changes we made to existing APIs that may or may not require your attention."),(0,o.kt)("h4",{id:"new-api"},"New API"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"pinch()"),"\u2014new API for pinching elements, replacing the deprecated ",(0,o.kt)("inlineCode",{parentName:"li"},"pinchWithAngle()")," (iOS)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"getAttributes()"),"\u2014new API for obtaining element properties (iOS)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"not"),"\u2014new API for inverting expectation logic (iOS, Android)")),(0,o.kt)("h4",{id:"modified-api-potentially-breaking-changes"},"Modified API (",(0,o.kt)("strong",{parentName:"h4"},"Potentially Breaking Changes"),")"),(0,o.kt)("p",null,"The following APIs have changed and require attention"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"by.text()"),"\u2014matching elements by text actually uses the element\u2019s text value instead of using the accessibility label (iOS)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"by.traits()"),"\u2014the supported trait values have changed (iOS)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"atIndex()"),"\u2014matched elements are now sorted by x and y axes to allow for stability between tests; indices will most likely change after upgrading to this version of Detox (iOS)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"tap()"),"\u2014this method now accepts an optional point to tap (iOS, Android)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setColumnToValue()"),"\u2014this method no longer supports date pickers; use ",(0,o.kt)("inlineCode",{parentName:"li"},"setDatePickerDate()")," to change picker dates (iOS)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"setDatePickerDate()"),"\u2014in addition to normal date formats, a new special case is introduced for ISO 8601 formatted date strings: ",(0,o.kt)("inlineCode",{parentName:"li"},'"ISO8601"')," (iOS)")),(0,o.kt)("h4",{id:"deprecated-api"},"Deprecated API"),(0,o.kt)("p",null,"The following APIs have been deprecated, but is still available"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"tapAtPoint()"),"\u2014the API has been consolidated with ",(0,o.kt)("inlineCode",{parentName:"li"},"tap(point)")," (iOS, Android)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"pinchWithAngle()"),"\u2014this API has been replaced with ",(0,o.kt)("inlineCode",{parentName:"li"},"pinch()")," (iOS)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"toBeNotVisible()"),"\u2014deprecated in favor of ",(0,o.kt)("inlineCode",{parentName:"li"},"not.toBeVisible()")," (iOS, Android)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"toNotExist()"),"\u2014deprecated in favor of ",(0,o.kt)("inlineCode",{parentName:"li"},"not.toExist()")," (iOS, Android)")),(0,o.kt)("p",null,"Make sure to read the API reference for ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/blob/master/docs/APIRef.Matchers.md"},"matchers"),", ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/blob/master/docs/APIRef.ActionsOnElement.md"},"actions")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/blob/master/docs/APIRef.Expect.md"},"expectations"),"."),(0,o.kt)("p",null,"If you see unexpected results, make sure to open an issue."),(0,o.kt)("h3",{id:"1600"},"16.0.0"),(0,o.kt)("p",null,"Detox now comes as a prebuilt framework on iOS, thus lowering npm install times and saving some build issues that happen due to unexpected Xcode setups."),(0,o.kt)("p",null,"To support this, Detox needs Swift 5 support, so the iOS requirements have changed slightly:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Xcode"),": 10.2 or higher",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"iOS Simulator Runtime"),": iOS 12.2 or higher")))),(0,o.kt)("p",null,"This does not require that your app require iOS 12.2, only that you build and run your app on Xcode 10.2 or above, and use an iOS 12.2 or above simulator."),(0,o.kt)("h3",{id:"1450"},"14.5.0"),(0,o.kt)("p",null,'It is recommended to change "name" string to "device" object in your configurations, like shown below:'),(0,o.kt)("p",null,"Before:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "ios.sim.debug": {\n    "type": "ios.simulator",\n    "name": "iPhone 11 Pro"\n  },\n  "android.emu.release": {\n    "type": "android.emulator",\n    "name": "Nexus_5X_API_29"\n  },\n  "android.att.release": {\n    "type": "android.attached",\n    "name": "YOGAA1BBB412"\n  }\n}\n')),(0,o.kt)("p",null,"After:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "ios.sim.debug": {\n    "type": "ios.simulator",\n    "device": { // one of these or a combination of them\n      "id": "D53474CF-7DD1-4673-8517-E75DAD6C34D6",\n      "type": "iPhone 11 Pro",\n      "name": "MySim",\n      "os": "iOS 13.0",\n    }\n  },\n  "android.emu.release": {\n    "type": "android.emulator",\n    "device": { // only avdName is supported at the moment\n      "avdName": "Nexus_5X_API_29",\n    }\n  },\n  "android.att.release": {\n    "type": "android.attached",\n    "device": { // only adbName is supported at the moment\n      "adbName": "YOGAA1BBB412",\n    }\n  }\n}\n')),(0,o.kt)("h3",{id:"1400"},"14.0.0"),(0,o.kt)("p",null,"Detox 14.0.0 drops support for iOS 9.x simulators, and thus it also drops support for any API that is deprecated in iOS 10 and above. This includes legacy ",(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623013-application?language=objc"},"remote")," and ",(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622930-application?language=objc"},"local")," notifications handling API. These APIs have been deprecated since iOS 10, and we believe we\u2019ve given app developers enough time to use the modern APIs. Make sure you transition to the ",(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/usernotifications?language=objc"},(0,o.kt)("inlineCode",{parentName:"a"},"UserNotifications")," framework")," as soon as possible."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Please note that for React Native apps, ",(0,o.kt)("a",{parentName:"strong",href:"https://facebook.github.io/react-native/docs/pushnotificationios"},(0,o.kt)("inlineCode",{parentName:"a"},"PushNotificationIOS")," (",(0,o.kt)("inlineCode",{parentName:"a"},"RCTPushNotificationManager"),")")," is severely outdated and does not support these modern APIs.")," It is recommended to transition to a more modern solution. While it is sad that such an important app feature is let to stagnate so much by Facebook, it cannot be the concern of Detox. It is up to RN users to keep their apps up to date with the latest Apple APIs."),(0,o.kt)("p",null,"Our ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/react-native-notifications"},"own React Native notifications solution")," supports these modern APIs."),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/1514"},"#1514"),"."),(0,o.kt)("h3",{id:"migrating-to-1270-from-older-nonbreaking"},"Migrating to 12.7.0 from older (nonbreaking)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"This is only relevant to those running Detox using ",(0,o.kt)("a",{parentName:"strong",href:"/Detox/docs/guide/jest"},(0,o.kt)("inlineCode",{parentName:"a"},"Jest")," as the test runner")),"!"),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"12.7.0")," we\u2019ve greatly improved our support in Jest - trying to tackle these two caveats which hold developers back from embracing it:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Jest file-level summary logs take precedence over 'plain' output, which makes them and all other logs (e.g. user in-test logging) seem cluttered."),(0,o.kt)("li",{parentName:"ol"},"Plain logs output is batched, and thus often does not show in real-time as the test is run. This is particularly annoying when running tests on the local computer."),(0,o.kt)("li",{parentName:"ol"},'Jest offers no spec-level logging => no way to tell what\u2019s running "right now" and which test created what log-outputs.')),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Put in simple words, Jest is optimized for running tests concurrently using multiple workers. This isn\u2019t the case when writing/debugging tests on a local machine.")),(0,o.kt)("p",null,"In ",(0,o.kt)("inlineCode",{parentName:"p"},"12.7.0")," we\u2019ve worked out a configuration scheme that aims at solving these by streamlining all test-related outputs. ",(0,o.kt)("strong",{parentName:"p"},"Please follow the updated ",(0,o.kt)("a",{parentName:"strong",href:"/Detox/docs/guide/jest"},"Jest installation guide"),", to set it up.")),(0,o.kt)("h3",{id:"migrating-from-detox-124x-to-1250-nonbreaking"},"Migrating from Detox 12.4.x to 12.5.0 (nonbreaking)"),(0,o.kt)("p",null,"Starting Detox ",(0,o.kt)("inlineCode",{parentName:"p"},"12.5.0"),", we ship Android with precompiled sources under a  ",(0,o.kt)("inlineCode",{parentName:"p"},".aar")," file. The complete configuration process is thoroughly described in the ",(0,o.kt)("a",{parentName:"p",href:"/Detox/docs/introduction/android"},"Android setup guide")," - but it mostly fits ",(0,o.kt)("strong",{parentName:"p"},"new")," projects. For existing projects, migrating is strongly recommended; here\u2019s the diff:"),(0,o.kt)("p",null,"Root ",(0,o.kt)("inlineCode",{parentName:"p"},"settings.gradle")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"-include ':detox'\n-project(':detox').projectDir = new File(rootProject.projectDir, '../node_modules/detox/android/detox')\n")),(0,o.kt)("p",null,"Root ",(0,o.kt)("inlineCode",{parentName:"p"},"buildscript")," (i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"build.gradle"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},'allprojects {\n    repositories {\n         // ...\n+        maven {\n+            url "$rootDir/../node_modules/detox/Detox-android"\n+        }\n     }\n }\n')),(0,o.kt)("p",null,"App ",(0,o.kt)("inlineCode",{parentName:"p"},"buildscript")," (i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"app/build.gradle"),"):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"}," dependencies {\n-    androidTestImplementation(project(path: \":detox\"))\n+    androidTestImplementation('com.wix:detox:+') { transitive = true }\n }\n")),(0,o.kt)("h4",{id:"proguard-configuration"},"ProGuard Configuration"),(0,o.kt)("p",null,"If you have Detox ProGuard rules integrated into the ",(0,o.kt)("inlineCode",{parentName:"p"},"app/build.gradle"),", be sure to switch to an explicit search path:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"     buildTypes {\n         release {\n         \n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n-            proguardFile \"${project(':detox').projectDir}/proguard-rules-app.pro\"\n+            proguardFile \"${rootProject.projectDir}/../node_modules/detox/android/detox/proguard-rules-app.pro\"\n\n         }\n     }\n")),(0,o.kt)("h3",{id:"migrating-from-detox-123x-to-1240"},"Migrating from Detox 12.3.x to 12.4.0"),(0,o.kt)("p",null,"The deprecation of ",(0,o.kt)("inlineCode",{parentName:"p"},'"specs"')," (in ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json"),") introduced in 12.1.0 is ",(0,o.kt)("strong",{parentName:"p"},"no longer relevant"),".\nIt is valid now, like it was before, but from now on the semantics has been slightly changed -\nit acts as a fallback for the default root for your Detox E2E specs, in cases when\nyou don\u2019t specify it explicitly, e.g.:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"detox test   # translates to: mocha <...args> e2e\ndetox test e2e/01.sanity.test.js  # translates to: mocha <...args> e2e/01.sanity.test.js\n")),(0,o.kt)("p",null,"Between 12.1.x and 12.3.x, it was buggy and used to work like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"detox test   # translates to: mocha <...args> e2e\ndetox test e2e/01.sanity.test.js  # translates to: mocha <...args> e2e e2e/01.sanity.test.js\n")),(0,o.kt)("h3",{id:"migrating-from-detox-120x-to-121x"},"Migrating from Detox 12.0.x to 12.1.x"),(0,o.kt)("p",null,"This is not a breaking change yet, but starting from ",(0,o.kt)("inlineCode",{parentName:"p"},"detox@12.1.0")," you\u2019ll start seeing warnings like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-plain",metastring:"text",text:!0},"detox[21201] WARN:  [deprecation.js] Beware: -f, --file will be removed in the next version of Detox.\ndetox[21201] WARN:  [deprecation.js] See the migration guide:\nhttps://github.com/wix/Detox/blob/master/docs/Guide.Migration.md#migrating-from-detox-120x-to-121x\n")),(0,o.kt)("p",null,"In the next major version ",(0,o.kt)("inlineCode",{parentName:"p"},"--file")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"--specs")," will be treated as unknown arguments\nand therefore passed as-is to your appropriate test runner. That allows to avoid name\nconflict with the respective ",(0,o.kt)("inlineCode",{parentName:"p"},"--file")," option in Mocha runner itself and other potential\ncollisions."),(0,o.kt)("p",null,"So, if you have been using CLI arguments like ",(0,o.kt)("inlineCode",{parentName:"p"},"--file e2e")," or\n",(0,o.kt)("inlineCode",{parentName:"p"},"--specs e2e"),", please drop the preceding ",(0,o.kt)("inlineCode",{parentName:"p"},"--file")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"--specs"),", so that:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"detox test --file e2e/01.sanity.test.js\n")),(0,o.kt)("p",null,"becomes:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"detox test e2e/01.sanity.test.js\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"UPDATE:")," It was decided not to deprecate ",(0,o.kt)("inlineCode",{parentName:"p"},'"specs"')," in ",(0,o.kt)("inlineCode",{parentName:"p"},"package.json"),", so the text below\nis not relevant to a large extent. Please ignore the guide below."),(0,o.kt)("p",null,(0,o.kt)("del",{parentName:"p"},"To get rid of this warning:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("del",{parentName:"li"},"find ",(0,o.kt)("inlineCode",{parentName:"del"},'"specs"')," or ",(0,o.kt)("inlineCode",{parentName:"del"},'"file"')," entry in your project\u2019s ",(0,o.kt)("inlineCode",{parentName:"del"},"package.json")," and empty it (e.g. ",(0,o.kt)("inlineCode",{parentName:"del"},'"e2e"')," \u27f6 ",(0,o.kt)("inlineCode",{parentName:"del"},'""'),");")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("del",{parentName:"li"},"update your ",(0,o.kt)("inlineCode",{parentName:"del"},"detox test")," scripts \u2014 make sure they have an explicit path to your Detox tests folder, e.g. ",(0,o.kt)("inlineCode",{parentName:"del"},"detox test e2e"),"."))),(0,o.kt)("p",null,(0,o.kt)("del",{parentName:"p"},"For example, if it were a ",(0,o.kt)("inlineCode",{parentName:"del"},"package.json")," before:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "your-project",\n  "scripts": {\n    "e2e:ios": "detox test -c ios.simulator.release"\n  },\n  "detox": {\n    "specs": "e2e"\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("del",{parentName:"p"},"Then this is how it should look like afterwards:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "name": "your-project",\n  "scripts": {\n    "e2e:ios": "detox test -c ios.simulator.release e2e"\n  },\n  "detox": {\n    "specs": ""\n  }\n}\n')),(0,o.kt)("p",null,(0,o.kt)("del",{parentName:"p"},"Notice that we appended ",(0,o.kt)("inlineCode",{parentName:"del"},"e2e")," to the ",(0,o.kt)("inlineCode",{parentName:"del"},"e2e:ios")," test script and\nemptied ",(0,o.kt)("inlineCode",{parentName:"del"},'"specs"')," property in ",(0,o.kt)("inlineCode",{parentName:"del"},"detox")," configuration.")),(0,o.kt)("p",null,(0,o.kt)("del",{parentName:"p"},"In a case if you had no ",(0,o.kt)("inlineCode",{parentName:"del"},'"specs"')," property in your ",(0,o.kt)("inlineCode",{parentName:"del"},"detox")," configuration\nin ",(0,o.kt)("inlineCode",{parentName:"del"},"package.json"),", then please add it temporarily like this:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "specs": ""\n}\n')),(0,o.kt)("h3",{id:"migrating-from-detox-1101-to-1200"},"Migrating from Detox 11.0.1 to 12.0.0"),(0,o.kt)("p",null,"The new version explicitly requires ",(0,o.kt)("strong",{parentName:"p"},"Xcode 10.1 or higher")," in order to run tests on iOS (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/issues/1229"},"#1229"),")."),(0,o.kt)("h3",{id:"migrating-from-detox-1100-to-1101-nonbreaking"},"Migrating from Detox 11.0.0 to 11.0.1 (nonbreaking)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"React Native versions older than 0.46 are no longer supported"),", so the ",(0,o.kt)("inlineCode",{parentName:"p"},"missingDimentsionStrategy")," can be removed from ",(0,o.kt)("inlineCode",{parentName:"p"},"android/app/build.gradle"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},'android {\n  defaultConfig {\n      // ...\n-        missingDimensionStrategy "minReactNative", "minReactNative46"\n    }\n}\n')),(0,o.kt)("h3",{id:"migrating-from-detox-10xx-to-11xx"},"Migrating from Detox 10.x.x to 11.x.x"),(0,o.kt)("h4",{id:"step-1"},"Step 1"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"android/app/build.gradle")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},'android {\n    defaultConfig {\n         // ...\n-        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"\n+        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"\n    }\n}\n\ndependencies {\n    implementation "com.facebook.react:react-native:+"  // From node_modules\n    androidTestImplementation(project(path: ":detox"))\n    androidTestImplementation \'junit:junit:4.12\'\n-   androidTestImplementation \'com.android.support.test:runner:1.0.2\'\n-   androidTestImplementation \'com.android.support.test:rules:1.0.2\'\n')),(0,o.kt)("h4",{id:"step-2"},"Step 2"),(0,o.kt)("p",null,"Rewrite your ",(0,o.kt)("inlineCode",{parentName:"p"},"DetoxTest.java")," file according to the updated ",(0,o.kt)("a",{parentName:"p",href:"/Detox/docs/introduction/android#5-create-a-detox-test-class"},"Android setup guide"),"."),(0,o.kt)("h3",{id:"migrating-from-detox-9xx-to-10xx"},"Migrating from Detox 9.x.x to 10.x.x"),(0,o.kt)("p",null,"If your project does not already use Kotlin, add the Kotlin Gradle-plugin to your ",(0,o.kt)("inlineCode",{parentName:"p"},"classpath")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"android/build.gradle"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-groovy"},"buildscript {\n    // ...\n    ext.kotlinVersion = '1.3.0'\n    \n    dependencies {\n        // ...\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion\"\n    }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Note: most guides advise of defining a global ",(0,o.kt)("inlineCode",{parentName:"em"},"kotlinVersion")," constant - as in this example, but that is not mandatory.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"IMPORTANT:")," Detox aims at a playing fair with your app, and so it allows you to explicitly define the Kotlin version for it to use - so as to align it with your own; Please do so - in your root ",(0,o.kt)("inlineCode",{parentName:"p"},"android/build.gradle")," configuration file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-groovy"},"buildscript {\n    ext.kotlinVersion = '1.3.0' // Your app\u2019s version\n    ext.detoxKotlinVersion = ext.kotlinVersion // Detox' version: should be 1.1.0 or higher!\n}\n")),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},(0,o.kt)("strong",{parentName:"em"},"Note that Detox has been tested for version 1.1.0 of Kotlin, and higher!"))),(0,o.kt)("h3",{id:"migrating-from-detox-8xx-to-9xx"},"Migrating from Detox 8.x.x to 9.x.x"),(0,o.kt)("p",null,"Detox 9.0.0 brings latest Espresso (3.0.2), and React Native 56 support on Android.\nEspresso 3.0.2 has a few mandatory dependency changes, which break the current setup for Detox users on Android."),(0,o.kt)("p",null,"Use this to diff to upgrade your dependencies, and follow Android Studio\u2019s in-editor guidance/lint support."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"android/app/build.gradle")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"\ndependencies {\n-   implementation \"com.android.support:appcompat-v7:27.0.2\"\n+   implementation \"com.android.support:appcompat-v7:27.1.1\"\n    implementation \"com.facebook.react:react-native:+\"  // From node_modules\n    androidTestImplementation(project(path: \":detox\"))\n    androidTestImplementation 'junit:junit:4.12'\n-   androidTestImplementation 'com.android.support.test:runner:1.0.1'\n-   androidTestImplementation 'com.android.support.test:rules:1.0.1'\n+   androidTestImplementation 'com.android.support.test:runner:1.0.2'\n+   androidTestImplementation 'com.android.support.test:rules:1.0.2'\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"android/build.gradle")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff"},"dependencies {\n-   classpath 'com.android.tools.build:gradle:3.0.1'\n+   classpath 'com.android.tools.build:gradle:3.1.4'\n}\n")),(0,o.kt)("p",null,"An example for the above changes can be found on ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/pull/914/files#diff-a4582798f3b7df5ccd62283b37b5573e"},(0,o.kt)("inlineCode",{parentName:"a"},"demo-react-native")," project")),(0,o.kt)("p",null,"More details about Espresso dependencies ",(0,o.kt)("a",{parentName:"p",href:"https://developer.android.com/training/testing/espresso/setup"},"here")),(0,o.kt)("h3",{id:"migrating-from-detox-7xx-to-8xx"},"Migrating from Detox 7.x.x to 8.x.x"),(0,o.kt)("p",null,"Detox 8.x.x brings support for test artifacts (videos, screenshot, logs), and to learn more about it you can refer to ",(0,o.kt)("a",{parentName:"p",href:"/Detox/docs/api/artifacts"},"Artifacts documentation")," and to ",(0,o.kt)("a",{parentName:"p",href:"/Detox/docs/api/detox-cli"},"Detox CLI documentation"),"."),(0,o.kt)("h4",{id:"changes-to-e2einitjs"},"Changes to ",(0,o.kt)("inlineCode",{parentName:"h4"},"e2e/init.js")),(0,o.kt)("p",null,"In order for Detox to be able to create artifacts, ",(0,o.kt)("inlineCode",{parentName:"p"},"detox.beforeEach(testSummary)")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"detox.afterEach(testSummary)")," must be called with a current test summary object (test title, full test name, test status)."),(0,o.kt)("p",null,"Detox 8 introduces adapters for both Mocha and Jest, wrapping the original ",(0,o.kt)("inlineCode",{parentName:"p"},"detox.beforeEach(testSummary)")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"detox.afterEach(testSummary)")," functions, for easier integration."),(0,o.kt)("p",null,"you are encouraged to reuse the examples of ",(0,o.kt)("inlineCode",{parentName:"p"},"./e2e/init.js")," for  ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/tree/master/examples/demo-react-native/e2e/init.js"},"mocha")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/tree/master/examples/demo-react-native-jest/e2e/init.js"},"jest"),". The gist is brought in the following sections:"),(0,o.kt)("h5",{id:"mocha"},(0,o.kt)("em",{parentName:"h5"},"Mocha")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const detox = require('detox');\nconst adapter = require('detox/runners/mocha/adapter');\n\nbefore(async () => {\n  await detox.init();\n});\n\nbeforeEach(async function () {\n  await adapter.beforeEach(this);\n});\n\nafterEach(async function () {\n  await adapter.afterEach(this);\n});\n\nafter(async () => {\n  await detox.cleanup();\n});\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},"NOTICE:"),"\nMake sure you use ES5 functions in ",(0,o.kt)("inlineCode",{parentName:"p"},"beforeEach")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"afterEach"),". ",(0,o.kt)("inlineCode",{parentName:"p"},"this")," refers to mocha\u2019s test object, using arrow functions will result with failure to acquire a correct ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"this"))," inside the adapter.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// \u2717 INCORRECT\n\nbeforeEach(() => { /* ... your content ... */ }); // won\u2019t work\nafterEach(() => { /* ... your content ... */ }); // won\u2019t work\n\n// CORRECT\n\nbeforeEach(function ( /* ... your content ... */ ) {});\nafterEach(function ( /* ... your content ... */ ) {});\n")),(0,o.kt)("h5",{id:"jest"},(0,o.kt)("em",{parentName:"h5"},"Jest")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const detox = require('detox');\nconst adapter = require('detox/runners/jest/adapter');\n\njest.setTimeout(120000);\njasmine.getEnv().addReporter(adapter); // don\u2019t forget this line\n\nbeforeAll(async () => {\n  await detox.init();\n});\n\nbeforeEach(async () => {\n  await adapter.beforeEach();\n});\n\nafterAll(async () => {\n  await adapter.afterAll();\n  await detox.cleanup();\n});\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("em",{parentName:"p"},"NOTICE:"),"\nMake sure to register the adapter as a Jasmine reporter in ",(0,o.kt)("inlineCode",{parentName:"p"},"init.js")," like this:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"jasmine.getEnv().addReporter(adapter);\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Jest adapter requires a hook to ",(0,o.kt)("inlineCode",{parentName:"li"},"afterAll"),":")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"afterAll(async () => {\n  await adapter.afterAll();\n  await detox.cleanup();\n});\n")),(0,o.kt)("h5",{id:"note-regarding-detoxbeforeeach-and-detoxaftereach"},"Note regarding ",(0,o.kt)("inlineCode",{parentName:"h5"},"detox.beforeEach")," and ",(0,o.kt)("inlineCode",{parentName:"h5"},"detox.afterEach")),(0,o.kt)("p",null,"API of these methods is subject to change in future versions due to complexity behind composing test summary objects (as in the case with Jest test runner). If you have reasons to make direct calls to ",(0,o.kt)("inlineCode",{parentName:"p"},"detox.beforeEach")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"detox.afterEach")," (e.g. you\u2019re adding support for another test runner), please refer to ",(0,o.kt)("a",{parentName:"p",href:"/Detox/docs/api/detox-object-api"},"detox object documentation"),"."),(0,o.kt)("h5",{id:"changes-to-detox-test-cli"},"Changes to ",(0,o.kt)("inlineCode",{parentName:"h5"},"detox test")," CLI"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"--artifact-location")," argument became optional for ",(0,o.kt)("inlineCode",{parentName:"p"},"detox test")," in the version 8.x.x.\nBy default it dynamically creates ",(0,o.kt)("inlineCode",{parentName:"p"},"./artifacts/{configuration}.{timestamp}")," directory in the project folder as soon as it has to save a recorded artifact."),(0,o.kt)("p",null,"Previously, to enable log recording you just had to specify ",(0,o.kt)("inlineCode",{parentName:"p"},"--artifact-location")," arg. Currently, you need to tell that explicitly via a new CLI flag: ",(0,o.kt)("inlineCode",{parentName:"p"},"--record-logs all")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"--record-logs failing"),"."),(0,o.kt)("p",null,"Notice that ",(0,o.kt)("inlineCode",{parentName:"p"},"--artifact-location")," became sensitive to whether you end your directory path with a slash or not. It has the next convention:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If you want to create automatically a subdirectory with timestamp and configuration name (to avoid file overwrites upon consequent reruns), specify a path to directory that ",(0,o.kt)("em",{parentName:"li"},"does not end")," with a slash."),(0,o.kt)("li",{parentName:"ul"},"Otherwise, if you want to put artifacts straight to the specified directory (in a case where you make a single run only, e.g. on CI), ",(0,o.kt)("em",{parentName:"li"},"add a slash")," to the end.")),(0,o.kt)("p",null,"For more information see ",(0,o.kt)("a",{parentName:"p",href:"/Detox/docs/api/detox-cli"},"CLI documentation"),"."),(0,o.kt)("h3",{id:"migrating-from-detox-4xx-to-5xx"},"Migrating from Detox 4.x.x to 5.x.x"),(0,o.kt)("p",null,"The clearest example for the 4->5 API changes is the change log of detox\u2019s own test suite.\nCheck ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/commit/c636e2281d83d07fe0b479681c1a8a6b809823ff#diff-bf5e338e4f0bb49210688c7691dc8589"},"detox test change log")," for a real life example."),(0,o.kt)("h4",{id:"version-5xx-breaks-detoxs-api-in-4-different-places"},"Version 5.x.x breaks detox\u2019s API in 4 different places"),(0,o.kt)("h5",{id:"1-promise-based-flow"},"1. Promise based flow"),(0,o.kt)("p",null,"All of the API calls are now promise based, and must use either promise chains or ",(0,o.kt)("inlineCode",{parentName:"p"},"async"),"-",(0,o.kt)("inlineCode",{parentName:"p"},"await"),"."),(0,o.kt)("p",null,"Here\u2019s an example of an async call to tap an element:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// <=4.x.x\nbeforeEach(() => {\n  element(by.text('Sanity')).tap();\n});\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// 5.x.x\nbeforeEach(async () => {\n  await element(by.text('Sanity')).tap();\n});\n")),(0,o.kt)("p",null,"Same thing with expectations"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// <=4.x.x\nit('should have welcome screen', () => {\n  expect(element(by.text('Welcome'))).toBeVisible();\n  expect(element(by.text('Say Hello'))).toBeVisible(); \n  expect(element(by.text('Say World'))).toBeVisible();\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// 5.x.x\nit('should have welcome screen', async () => {\n  await expect(element(by.text('Welcome'))).toBeVisible();\n  await expect(element(by.text('Say Hello'))).toBeVisible();\n  await expect(element(by.text('Say World'))).toBeVisible();\n});\n")),(0,o.kt)("h5",{id:"2-detox-object-has-a-leaner-api"},"2. ",(0,o.kt)("inlineCode",{parentName:"h5"},"detox")," object has a leaner API"),(0,o.kt)("p",null,"Configure and init detox with just one promise based function."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// <=4.x.x\ndetox.config(config);\ndetox.start(done);\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// 5.x.x\nawait detox.init(config);\n")),(0,o.kt)("p",null,"No need to wait for test result after each test, you can safely remove ",(0,o.kt)("inlineCode",{parentName:"p"},"detox.waitForTestResult")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// <=4.x.x\nafterEach((done) => {\n  detox.waitForTestResult(done);\n});\n")),(0,o.kt)("p",null,"cleanup is promise based"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// <=4.x.x\ndetox.cleanup(done);\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// 5.x.x\nawait detox.cleanup();\n")),(0,o.kt)("h5",{id:"3-simulator-is-now-device"},"3. ",(0,o.kt)("inlineCode",{parentName:"h5"},"simulator")," is now ",(0,o.kt)("inlineCode",{parentName:"h5"},"device")),(0,o.kt)("p",null,"The global object ",(0,o.kt)("inlineCode",{parentName:"p"},"simulator")," is now ",(0,o.kt)("inlineCode",{parentName:"p"},"device"),", this change makes sense when thinking about multi-platform tests (Android support).\nAlong with the new promise based API, this is how we now control the attached device"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"<=4.x.x"),(0,o.kt)("th",{parentName:"tr",align:null},"5.x.x"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"simulator.reloadReactNativeApp(done)")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"await device.reloadReactNative()"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"simulator.relaunchApp(done)")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"await device.relaunchApp()"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"simulator.sendUserNotification(params, done)")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"await device.sendUserNotification(params)"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"simulator.openURL(url)")),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("inlineCode",{parentName:"td"},"await device.openURL(url)"))))),(0,o.kt)("h5",{id:"4-detox-config-scheme"},"4. Detox config scheme"),(0,o.kt)("p",null,"In order for our API to support multiple platforms and devices, and to be able to provide a valid command line tool, we changed the Detox configuration scheme (in package.json)"),(0,o.kt)("p",null,"Previous config looked like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'//<=4.x.x\n  "detox": {\n    "session": {\n      "server": "ws://localhost:8099",\n      "sessionId": "test"\n    },\n    "ios-simulator": {\n        "app": "ios/build/Build/Products/Release-iphonesimulator/example.app",\n        "device": "iPhone 7 Plus"\n    }\n  }\n')),(0,o.kt)("p",null,"The new configuration holds a dictionary of ",(0,o.kt)("inlineCode",{parentName:"p"},"configurations"),"."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Each configuration must state ",(0,o.kt)("inlineCode",{parentName:"li"},"type")," - currently only simulator is supported"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"app")," is now ",(0,o.kt)("inlineCode",{parentName:"li"},"binaryPath")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"build")," - ",(0,o.kt)("strong",{parentName:"li"},"[","optional]")," build command (either ",(0,o.kt)("inlineCode",{parentName:"li"},"xcodebuild"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"react-native run-ios"),", etc...), will be later available through detox CLI tool."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"session object is not mandatory anymore"),", if is not provided detox will handle server creation by itself.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'//5.x.x\n  "detox": {\n    "configurations": {\n      "ios.sim.release": {\n        "binaryPath": "ios/build/Build/Products/Release-iphonesimulator/example.app",\n        "build": "xcodebuild -project ios/example.xcodeproj -scheme example -configuration Release -sdk iphonesimulator -derivedDataPath ios/build",\n        "type": "ios.simulator",\n        "name": "iPhone 7 Plus"\n      }\n    } \n  }\n')),(0,o.kt)("h5",{id:"31-start-using-detox-cli"},"3.1 Start using ",(0,o.kt)("inlineCode",{parentName:"h5"},"detox-cli")),(0,o.kt)("p",null,"You will now be able to run builds and tests from your command line ",(0,o.kt)("inlineCode",{parentName:"p"},"detox build")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"detox test"),", read more about CLI tools ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/wix/Detox/blob/7323ad98f576a10404b24feba662d064cda9cc30/docs/APIRef.DetoxCLI.md"},"here")),(0,o.kt)("h3",{id:"migrating-from-detox-3xx-to-4xx"},"Migrating from Detox 3.x.x to 4.x.x"),(0,o.kt)("p",null,"If you have integrated with Detox in version 3.x.x, you will need to clean your project from previously generated targets."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Use the provided ",(0,o.kt)("inlineCode",{parentName:"p"},"cleanup_4.0.rb")," to remove unneeded changes made with Detox 4.x.x."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"ruby node_modules/detox/scripts/cleanup_4.0.rb\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The script will delete previously configured project targets ",(0,o.kt)("inlineCode",{parentName:"p"},"*_Detox"),". The targets are not used by detox anymore since the framework is now injected at runtime and doesn\u2019t need to be linked in a different target.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Make sure to add changes performed by running this script to version control."))))}m.isMDXComponent=!0}}]);